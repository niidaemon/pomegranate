# ===================================================================
# PostgreSQL Standby Configuration
# ===================================================================
# This file is based on the primary's postgresql.conf, with modifications
# required for standby/replica operation.
# ===================================================================

# -----------------------------
# CONNECTIONS AND AUTHENTICATION
# -----------------------------
# (copied from primary, unchanged)
listen_addresses = '*'
port = 5432
max_connections = 100

# -----------------------------
# WRITE-AHEAD LOG
# -----------------------------
# (copied from primary, unchanged except for standby-specific behavior)
wal_level = replica
archive_mode = on
archive_command = 'cp %p /var/lib/postgresql/data/archive/%f'

# -----------------------------
# REPLICATION
# -----------------------------
# (copied from primary, with standby-specific overrides below)

# Allow queries during recovery
hot_standby = on                     # standby must allow read-only queries

# Maximum delay allowed for applying streaming WAL before canceling queries
max_standby_streaming_delay = 30s

# Maximum delay allowed for applying WAL from archive before canceling queries
max_standby_archive_delay = 30s

# Retry interval for retrieving WAL files
wal_retrieve_retry_interval = 1s

# -----------------------------
# QUERY TUNING
# -----------------------------
# (copied from primary, unchanged)
shared_buffers = 256MB
work_mem = 4MB
maintenance_work_mem = 64MB

# -----------------------------
# ERROR REPORTING AND LOGGING
# -----------------------------
# (copied from primary, unchanged)
logging_collector = on
log_directory = 'log'
log_filename = 'postgresql-%a.log'
log_statement = 'none'

# -----------------------------
# RUNTIME BEHAVIOR
# -----------------------------
# Standby should not allow writes
default_transaction_read_only = on

# ===================================================================
# End of Standby Configuration
# ===================================================================
